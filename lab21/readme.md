# Лабораторная работа №21. **OSPF**.

[scheme]: https://github.com/alexeybobovsky/OTUS_Lab/blob/master/lab21/img/scheme.png "" 
[img1]: https://github.com/alexeybobovsky/OTUS_Lab/blob/master/lab21/img/scr1.PNG "" 
[img2]: https://github.com/alexeybobovsky/OTUS_Lab/blob/master/lab21/img/scr2.PNG "" 
[img3]: https://github.com/alexeybobovsky/OTUS_Lab/blob/master/lab21/img/scr3.PNG "" 
[img4]: https://github.com/alexeybobovsky/OTUS_Lab/blob/master/lab21/img/scr4.PNG "" 

## Задание: Настраиваем "OSPF"

- Поднять три виртуалки
- Объединить их разными vlan
1. Поднять **OSPF** между машинами на базе **Quagga**
2. Изобразить ассиметричный роутинг
3. Сделать один из линков "дорогим", но что бы при этом роутинг был симметричным

## Решение

* Для наглядности, приводится схема сетевого взаимодействия узлов (маршрутизаторов) стенда.

![схема сети][scheme]

* В репозиторий **GitHUB** добавлен [Vagrant файл](https://github.com/alexeybobovsky/OTUS_Lab/blob/master/lab21/Vagrantfile),  который  разворачивает требуемый стенд из 3 виртуалок.

### Описание действий для автонастройки стенда 

* В **Vagrantfile** для каждой станции на интерфейсах выставляются адреса согласно схемы. Везде устанавливаются сетевые настройки ядра, такие как включение ```ip_forward``` и отключение ```rp_filter```. На каждом хосте устанавливается **Quagga** с заранее подготовленными конфигурационными файлами ```zebra.conf``` и ```ospfd.conf```

## Проверка работы стенда

* На **R1** осуществляется вывод адресов сетевых интерфейсов и схема маршрутизации. Также выполняется трассировка пакета до не связанного напрямую с **R1** интерфейса на роутере **R3**, который проходит по кратчайшему пути.

![начальный маршрут][img1]

* На **R1** увеличивается стоимость (```cost```) линка до **R3**. При выполнении трассировки до того же не связанного напрямую с **R1** интерфейса на роутере **R3**, видно что пакет идет по ***обходному*** маршруту за 2 хопа.

![повышение стоимости маршрута][img2]

* На **R3** осуществляется вывод адресов сетевых интерфейсов и схемы маршрутизации. Так же как и на **R1** выполняется трассировка пакета до не связанного напрямую с **R3** интерфейса на роутере **R1**, который также возвращается с другого интерфейса по обходному маршруту. 

![проверка с другого роутера][img3]

* Для возвращения ***симметричности*** роутинга выставляется аналогичная стоимость на другом линке. Снова выполняется трассировка пакета до **R1**  и в этот раз он уже проходит по кратчайшему маршруту. 

![симметричный роутинг][img4]

